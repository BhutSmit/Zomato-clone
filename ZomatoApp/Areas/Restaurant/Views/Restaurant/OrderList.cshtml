@using System.Data;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

    .line {
        width: 50%;
        height: 1px;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    ::placeholder {
        font-size: 13px;
    }

    .table-container {
        /*overflow: scroll;*/
        overflow-x: scroll;
    }

    .activeRestaurant {
        width: 10px;
        height: 10px;
        background-color: rgba(100, 255, 150, 0.9);
        border-radius: 50%;
    }

    .unactiveRestaurant {
        width: 10px;
        height: 10px;
        background-color: rgba(255, 100, 150, 0.9);
        border-radius: 50%;
    }

    .alert-container {
        width: 100%;
        height: 60px;
    }

    .card-container {
        width: 300px;
        height: 320px;
        background-color: #ffffff;
        border: 1px solid rgba(180, 180, 180, 0.8);
        border-radius: 10px;
        padding: 15px;
    }

    .active-card {
        box-shadow: 0px 0px 0px 2px rgba(150, 10, 10, 0.1);
        transition: all 0.3s linear;
    }

        .active-card:hover {
            box-shadow: 0px 0px 10px 5px rgba(150, 10, 10, 0.1);
        }

    .inactive-card {
        opacity: 0.5;
        transition: all 0.3s linear;
    }

        .inactive-card:hover {
            opacity: 1;
        }

    .image-container {
        width: 100%;
        height: 150px;
        position: relative;
        /*border: 1px solid rgba(10 , 10 , 10 , 0.2);*/
        border-radius: 10px;
        overflow: hidden;
    }

        .image-container img {
            width: 100%;
            height: 100%;
            position: absolute;
            object-fit: cover;
        }

    .restaurant-name {
        font-size: 20px;
        font-weight: 600;
    }

    .rating-container {
        background-color: rgba(150, 250, 150, 0.8);
        font-size: 10px;
        border-radius: 20px;
        padding: 5px 10px;
    }

    .address {
        font-size: 10px;
    }

    .restaurant-time {
        font-size: 10px;
    }

    .button-container {
        background-color: #ffffff;
        padding: 10px;
        border: 1px solid rgba(0, 0, 0, 0.2);
        border-radius: 10px 0px 10px 0px;
        position: absolute;
        bottom: 0;
        right: 0;
    }

    .restaurant-button {
        width: 30px;
        height: 30px;
        font-size: 10px;
        background-color: transparent;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .RestaurntCheck:checked {
        border: 2px solid;
    }

    ::-webkit-scrollbar {
        width: 5px;
        height: 3px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: #efefef;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: rgba(240, 240, 240, 0.8);
    }

        ::-webkit-scrollbar-thumb:horizontal {
            background: #efefef;
            border-radius: 10px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

</style>

<div class="alert-container">
    @if (TempData["Data"] != null)
    {
        <div class="alert alert-success" role="alert">
            @TempData["Data"]
        </div>
    }
</div>

<div class="pagetitle my-1 mx-2">
    <h1>Dashboard</h1>
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item active">Restaurant</li>
        </ol>
    </nav>
</div><!-- End Page Title -->

<div class="border rounded px-5 py-3 shadow-sm mb-3">

    <p class="text-secondary">
        <span class="ms-1 me-2">&#x2022</span> Filter
    </p>

    <form asp-area="Restaurant" asp-controller="Restaurant">
        <div class="row">
            <div class="col ms-auto">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="RestaurantName" name="RestaurantName" placeholder="Search Restaurant Name here">
                    @* <input type="hidden" name="CountryName" value="CountryName" />*@
                </div>
            </div>

            <div class="col">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="Address" name="Address" placeholder="Search Address here">
                    @*<input type="hidden" name="CountryCode" value="CountryCode" />*@
                </div>
            </div>

            <div class="col">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="IsActive" name="IsActive" placeholder="Search IsActive here">
                    @*<input type="hidden" name="CountryCode" value="CountryCode" />*@
                </div>
            </div>
            <div class="col d-flex">
                <div>
                    <div class="input-group">
                        <input type="submit" asp-action="RestaurantFilter" class="btn border border-primary text-primary" id="" value="Apply Filter" placeholder="Search Country Code here">
                    </div>
                </div>

                <div class="ms-2">
                    <div class="input-group">
                        <input type="submit" asp-action="RestaurantList" class="btn" style="border: 2px solid rgba(10 , 10 , 10 , 0.5)" id="" value="Clear Filter" placeholder="Search Country Code here">
                    </div>
                </div>
            </div>

        </div>
    </form>

</div>

<div class="border rounded px-5 py-2 shadow-sm mb-3">

    <div>
        <div class="w-25 my-3">
            <p class="text-secondary">
                <span class="ms-1 me-2">&#x2022</span> Search With JQuery
            </p>
            <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
            <div class="input-group">
                <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                <input type="text" class="form-control" id="myInput" placeholder="Search here">
            </div>
        </div>

    </div>

</div>

<div class="border rounded p-5 shadow table-container">

    <div class="d-flex justify-content-between align-items-center">

        <h5 class="fw-bold"><i class="bi bi-gear me-2" style="font-size: 20px"></i>ORDER LIST</h5>
        <a asp-area="Restaurant" asp-controller="Restaurant" asp-action="AddEditRestaurant">
            <button class="btn bg-success text-white py-2"><i class="bi bi-plus-circle me-2"></i>Add Restaurant</button>
        </a>

    </div>

    <hr />

    <table class="table table-striped table-bordered table-responsive mt-4">
        <thead>
            <tr>
                @*<th scope="col">CountryId</th>*@
                <th scope="col" class="text-center">FoodType</th>
                <th scope="col" class="text-center">Name</th>
                <th scope="col" class="text-center">Quantity</th>
                <th scope="col" class="text-center">Price</th>
                <th scope="col" class="text-center">TotalAmount</th>
                <th scope="col" class="text-center">Address</th>
                <th scope="col" class="text-center">Status</th>
                <th scope="col" class="text-center">RecieveAt</th>
                <th scope="col" class="text-center">Status</th>
            </tr>
        </thead>
        <tbody id="myTable">

            @foreach (DataRow dr in Model.Rows)
            {

                <tr>
                    @*<td class="text-center">@dr["CountryID"]</td>*@
                    <td class="text-center">@dr["FoodTypeName"]</td>
                    <td class="text-center">@dr["FoodName"]</td>
                    <td class="text-center">@dr["Quantity"]</td>
                    <td class="text-center">@dr["Price"]</td>
                    <td class="text-center">@dr["TotalAmount"]</td>
                    <td class="text-center">@dr["Address"]</td>
                    <td class="text-center">@dr["StatusName"]</td>
                    <td class="text-center">@dr["Created"]</td>
                    <td class="text-center">

                        <select class="form-control" id="statusDropdown">
                            <option>Select Status</option>
                            @foreach (StatusModel dr1 in ViewBag.StatusList)
                            {
                                <option value="@dr1.StatusID">@dr1.StatusName</option>
                            }
                        </select>

                        <form id="updateStatusForm" method="post" asp-area="Restaurant" asp-controller="Restaurant" asp-action="UpdateStatus">
                            <input type="hidden" name="OrderID" id="OrderID" value="@Convert.ToInt32(dr["OrderID"])" />
                            <input type="hidden" name="RestaurantID" id="RestaurantID" value="@Convert.ToInt32(dr["RestaurantID"])" />
                            <input type="hidden" name="StatusID" id="StatusID" />
                        </form>

                    </td>
                </tr>
            }

        </tbody>
    </table>

</div>

<canvas id="salesChart" width="400" height="200"></canvas>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>


@section Scripts {

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

    <script>
        $(document).ready(function () {
            //alert("Hello");
            $("#myInput").on("keyup", function () {
                //alert("Function");
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });

        });

        function deleteSelected() {
            console.log("Deleting selected...");

            var form = document.getElementById("deleteForm");
            var checkboxes = document.getElementsByName("selectedRestaurants");
            var selectedRestaurantIds = [];

            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    selectedRestaurantIds.push(checkbox.value);
                }
            });

            // Set the value of the hidden field with the selected restaurant IDs
            document.getElementById("selectedRestaurantIds").value = selectedRestaurantIds.join(',');

            console.log("Submitting form...");
            form.submit();
        }

        async function deleteRestaurant() {

            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: "Deleted!",
                        text: "Your file has been deleted.",
                        icon: "success"
                    });

                    alert("Hello");
                    return true;
                }
                else {

                    alert("Hello1")
                    return false;
                }
            });

            //if (confirm("Are you sure want to delete?")) {

            //    return true

            //}

            //return false

        }

        var chartData = @Html.Raw(Json.Serialize(ViewBag.ChartData));
        console.log(chartData);
        var ctx = document.getElementById('salesChart').getContext('2d');
        var salesChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartData.map(data => data.Date),
                datasets: [{
                    label: 'Total Sales',
                    data: chartData.map(data => data.TotalSales),
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var dataIndex = tooltipItem.index;
                            var salesInfo = chartData[dataIndex];
                            return salesInfo.Date + ': $' + salesInfo.TotalSales;
                        }
                    }
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Sales'
                        }
                    }],
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Date'
                        }
                    }]
                }
            }
        });


        document.getElementById('statusDropdown').addEventListener('change', function () {
            alert("hello")
            var selectedStatus = this.value;
            var orderId = document.getElementById('OrderID').value;
            var restaurantId = document.getElementById('RestaurantID').value;
            alert(selectedStatus)
            if (selectedStatus && orderId && restaurantId) {
                document.getElementById("StatusID").value = this.value;
                document.getElementById('updateStatusForm').submit();   
            }
        });

        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            })
        }, 1000);

    </script>

}
