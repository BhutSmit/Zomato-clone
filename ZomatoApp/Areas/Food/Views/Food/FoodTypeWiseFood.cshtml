@using System.Data;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using Microsoft.AspNetCore.Http;
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor;

<style>

    .line {
        width: 50%;
        height: 1px;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    ::placeholder {
        font-size: 13px;
    }

    .table-container {
        /*overflow: scroll;*/
        overflow-x: scroll;
    }

    p {
        margin: 0;
        padding: 0;
    }

    .card-container {
        width: 230px;
        height: 320px;
        position: relative;
        border: 2px solid #ced6e0;
        border-radius: 20px;
        background-color: #f1f2f6;
        padding: 13px;
    }

    .image-container {
        width: 100%;
        height: 150px;
        border-radius: 5px;
        position: relative;
        overflow: hidden;
    }

        .image-container img {
            width: 100%;
            height: 100%;
            position: absolute;
            object-fit: contain;
        }

    .foodName {
        width: 100px;
        font-size: 16px;
        font-weight: 700;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .staus-cnotainer {
        margin: 2px 0px;
    }

    .status {
        color: #a4b0be;
        font-size: 10px;
    }

    .vegiterian {
        width: 15px;
        height: 15px;
        border: 2px solid rgba(10, 150, 10, 0.8);
        border-radius: 2px;
        position: absolute;
        top: 10px;
        left: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .veg-circle {
        width: 6px;
        height: 6px;
        background-color: rgba(10, 150, 10, 0.8);
        border-radius: 50%;
    }

    .vegiteriannon {
        width: 15px;
        height: 15px;
        border: 2px solid rgba(150, 10, 10, 0.8);
        border-radius: 2px;
        position: absolute;
        top: 10px;
        left: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .vegnon-circle {
        width: 5px;
        height: 5px;
        background-color: rgba(150, 10, 10, 0.8);
        border-radius: 50%;
    }

    .description {
        font-size: 13px;
    }

    .alert-container {
        width: 100%;
        height: 60px;
    }

    .food-button {
        width: 70px;
        height: 30px;
        border: 2px solid rgba(50, 80, 150, 0.5);
        border-radius: 10px;
        margin: 0px 10px 0px 0px;
        font-size: 10px;
    }

    #slider-range {
        width: 80%; /* Set the width of the slider */
        margin: 20px auto; /* Center the slider horizontally with some margin */
        border-radius: 10px;
    }

    .ui-slider-range {
        background: #70a1ff; /* Change the color of the selected range */
    }

    .ui-slider-handle {
        background: #337ab7; /* Change the color of the slider handles */
        border: 2px solid #f1f2f6; /* Add a border to the slider handles */
        border-radius: 50%;
    }

    ::-webkit-scrollbar {
        width: 5px;
        height: 3px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: #efefef;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: rgba(240, 240, 240, 0.8);
    }

        ::-webkit-scrollbar-thumb:horizontal {
            background: #efefef;
            border-radius: 10px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

</style>

<div class="alert-container">
    @if (TempData["Data"] != null)
    {
        <div class="alert alert-success" role="alert">
            @TempData["Data"]
        </div>
    }
</div>

@if (Model.Rows.Count > 0)
{
    <div class="pagetitle my-1 mx-2">
        <h1>Dashboard</h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item active">Food</li>
            </ol>
        </nav>
    </div>

    <!-- End Page Title -->
}

<form asp-area="FoodType" asp-controller="FoodType" asp-action="RestaurantWiseFoodType">

    <input type="hidden" name="RestaurantID" value="@Convert.ToInt32(TempData["myData"])" />
    <button class="btn border border-secondary my-2">< Back</button>

</form>

@*<div class="border rounded px-5 py-3 shadow-sm mb-3">

    <p class="text-secondary">
        <span class="ms-1 me-2">&#x2022</span> Filter
    </p>

    <form id="filterForm">
        <div class="row">
            <div class="col ms-auto">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="FoodName" name="FoodName" placeholder="Search Food Name here">
                     <input type="hidden" name="CountryName" value="CountryName" />
                </div>
            </div>
            <div class="col ms-auto">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="Price" name="Price" placeholder="Search Price here">
                    <input type="hidden" name="CountryName" value="CountryName" />
                </div>
            </div>
            <div class="col ms-auto">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="IsVegiterian" name="IsVegiterian" placeholder="Search IsVegiterian here">
                    <input type="hidden" name="CountryName" value="CountryName" />
                </div>
            </div>
            <div class="col ms-auto">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="IsActive" name="IsActive" placeholder="Search IsActive here">
                     <input type="hidden" name="CountryName" value="CountryName" />
                </div>
            </div>
            <div class="col ms-auto">
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="Review" name="Review" placeholder="Search Review here">
                     <input type="hidden" name="CountryName" value="CountryName" />
                </div>
            </div>
            <div class="mt-2">

                <p>
                    <label for="amount">Price range:</label>
                    <input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
                </p>
                <span id="currentValues"></span>
                <div id="slider-range"></div>

            </div>
            <div class="mt-3">
                <div class="col d-flex">
                    <div>
                        <div class="input-group">
                            <input type="button" class="btn border border-primary text-primary" id="applyFilterBtn" value="Apply Filter" placeholder="Search Country Code here">
                        </div>
                    </div>

                    <div class="ms-2">
                        <div class="">
                            <input type="hidden" name="RestaurantID" value="@HttpContextAccessor.HttpContext.Session.GetInt32("FoodTypeID")" />
                            <input type="submit" asp-action="FoodTypeWiseFood" class="btn" style="border: 2px solid rgba(10 , 10 , 10 , 0.5)" id="" value="Clear Filter" placeholder="Search Country Code here">
                       </div>
                    </div>
                </div>
            </div>

        </div>
    </form>

</div>*@

<partial name="_FilterPartialView" />

@if (Model.Rows.Count > 0)
{
    <div class="border rounded px-5 py-2 shadow-sm mb-3">

        <div>FoodTypeID - @HttpContextAccessor.HttpContext.Session.GetInt32("FoodTypeID")</div>
        <div>RestaurantID -  @HttpContextAccessor.HttpContext.Session.GetInt32("RestaurantID")</div>

        <div>
            <div class="w-25 my-3">
                <p class="text-secondary">
                    <span class="ms-1 me-2">&#x2022</span> Search With JQuery
                </p>
                <label class="visually-hidden" for="autoSizingInputGroup">Username</label>
                <div class="input-group">
                    <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                    <input type="text" class="form-control" id="myInput" placeholder="Search here">
                </div>
            </div>

        </div>

    </div>

    <div class="border shadow-sm p-4">

        <div class="d-flex justify-content-end align-items-center">

            <a asp-area="Food" asp-controller="Food" asp-action="AddEditFood">
                <button class="btn bg-success text-white py-2"><i class="bi bi-plus-circle me-2"></i>Add Food</button>
            </a>

        </div>

        <div class="d-flex mt-2">

            @foreach (DataRow dr in Model.Rows)
            {

                <div class="card-container shadow-sm me-3">
                        
                    <div class="image-container">

                        <img src=@dr["FoodImage"] />

                    </div>
                    @if (Convert.ToBoolean(dr["IsVegiterian"]))
                    {

                        <div class="vegiterian">
                            <div class="veg-circle"></div>
                        </div>

                    }
                    else
                    {
                        <div class="vegiteriannon">
                            <div class="vegnon-circle"></div>
                        </div>
                    }
                    <div class="d-flex justify-content-between align-items-center mt-2">

                        <p class="foodName">@dr["FoodName"]</p>
                        <p>@dr["Price"]</p>

                    </div>
                    <div class="d-flex mt-1">
                        <i class="bi bi-star" style="color: rgba(200 , 30 , 50 , 0.8)"></i>
                        <p class="ms-2">@dr["Review"]</p>

                    </div>
                    <div class="staus-cnotainer">

                        @if (Convert.ToBoolean(dr["IsActive"]))
                        {
                            <p class="status">Available</p>
                        }
                        else
                        {
                            <p class="status">Not Available</p>
                        }

                    </div>
                    <div class="description-container mt-2">

                        <p class="description">@dr["Description"]</p>

                    </div>

                    <div class="d-flex mt-2">
                        <form method="post" asp-area="Food" asp-controller="Food" asp-action="AddEditFood">
                            <input type="hidden" name="FoodID" value="@Convert.ToInt32(dr["FoodID"])" />
                            <button type="submit" class="text-primary food-button"><i class="bi bi-pen me-1" style=""></i>Edit</button>
                        </form>
                        <form method="post" asp-area="Food" asp-controller="Food" asp-action="DeleteFood">
                            <input type="hidden" name="FoodID" value="@Convert.ToInt32(dr["FoodID"])" />
                            <button type="submit" onclick="return deleteFood()" class="text-danger food-button"><i class="bi bi-trash me-1" style=""></i>Delete</button>
                        </form>
                    </div>

                </div>

            }

        </div>

    </div>
}
else
{

    <div class="container shadow-sm">
        <div class="d-flex justify-content-end align-items-center">

            <a asp-area="Food" asp-controller="Food" asp-action="AddEditFood">
                <button class="btn bg-success text-white py-2"><i class="bi bi-plus-circle me-2"></i>Add Food</button>
            </a>

        </div>

        <div class="text-center">
            <img src="~/img/No data.gif" style="mix-blend-mode: darken;" />
        </div>

    </div>
}

@section Scripts {

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.js" asp-append-version="true"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js" asp-append-version="true"></script>

    <script>
        $(document).ready(function () {

            $("#myInput").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });

            $(function () {
                $("#slider-range").slider({
                    range: true,
                    min: 0,
                    max: 500,
                    values: [90, 100],
                    slide: function (event, ui) {
                        $("#amount").val("$" + ui.values[0] + " - $" + ui.values[1]);
                        $("#currentValues").text("Current values: $" + ui.values[0] + " - $" + ui.values[1]);

                        // Additional code to send values to the server if needed
                        updateSliderValues(ui.values[0], ui.values[1]);
                    }
                });

                function updateSliderValues(value1, value2) {
                    $.ajax({
                        url: "Food/Food/UpdateSliderValues",
                        method: "POST",
                        data: { value1: value1, value2: value2 },
                        success: function (response) {
                            console.log("Slider values updated on the server.");
                        },
                        error: function (error) {
                            console.error("Error updating slider values:", error);
                        }
                    });
                }

                // Set initial value
                $("#amount").val("$" + $("#slider-range").slider("values", 0) +
                    " - $" + $("#slider-range").slider("values", 1));

                $("#currentValues").text("Current values: $" + $("#slider-range").slider("values", 0) +
                    " - $" + $("#slider-range").slider("values", 1));
            });

            $("#applyFilterBtn").click(function () {
                var formData = $("#filterForm").serializeArray();
                var sliderValues = $("#slider-range").slider("option", "values");

                // Remove existing SliderValue1 and SliderValue2 entries from formData
                formData = formData.filter(item => item.name !== "SliderValue1" && item.name !== "SliderValue2");

                // Add individual parameters for SliderValue1 and SliderValue2
                formData.push({ name: "SliderValue1", value: sliderValues[0] });
                formData.push({ name: "SliderValue2", value: sliderValues[1] });

                $.ajax({
                    url: "/Food/Food/FoodFilter",
                    method: "POST",
                    data: formData,
                    success: function (response) {
                        console.log("Filter applied successfully.");
                    },
                    error: function (error) {
                        console.error("Error applying filter:", error);
                    }
                });
            });

        });

        function deleteFood() {

            if (confirm("Are you sure want to delete?")) {

                return true

            }

            return false

        }

        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            })
        }, 1000);

    </script>

}
